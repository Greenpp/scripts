#!/bin/sh

url_file="$HOME/.music_to_download"
download_dir="$HOME/Music/Downloads"

[ ! -f $url_file ] && exit
[ ! -d $download_dir ] && mkdir -p $download_dir

tmp_file=$(mktemp)
url_num=$(wc -l $url_file | cut -d ' ' -f1)

succes=$(( 0 ))
cd $download_dir
for url in $(cat $url_file); do
    notify-send "Downloading..." "$(youtube-dl --no-warnings --get-title $url 2>/dev/null)"
    sleep 3
    youtube-dl --extract-audio --audio-format mp3 --audio-quality 0 $url >/dev/null 2>&1

    if [ $? -eq 0 ]; then
        succes=$(( $succes + 1 ))
    else
        echo $url >> $tmp_file
    fi
    sleep 3
done

mv $url_file $url_file.bak
mv $tmp_file $url_file
notify-send "DONE" "Downloaded $succes/$url_num files"

