#!/bin/sh

[ ! -f $HOME/.music_to_download ] && exit

tmp_file=$(mktemp)
url_num=$(wc -l | cut -d ' ' -f1)

succes=$(( 0 ))
cd $HOME/Music/Downloads
for url in $(cat $HOME/.music_to_download); do
    notify-send "Downloading..." "$(youtube-dl --no-warnings --get-title $url 2>/dev/null)"
    sleep 3
    youtube-dl --extract-audio --audio-format mp3 --audio-quality 0 $url >/dev/null 2>&1

    if [ $? -eq 0 ]; then
        succes=$(( $succes + 1 ))
    else
        echo $url >> $tmp_file
    fi
    sleep 3
done

mv $HOME/.music_to_download $HOME/.music_to_download.bak
mv $tmp_file $HOME/.music_to_download
notify-send "DONE" "Downloaded $succes/$url_num files"

